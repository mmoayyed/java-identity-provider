<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:webflow="http://www.springframework.org/schema/webflow-config"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/webflow-config http://www.springframework.org/schema/webflow-config/spring-webflow-config-2.3.xsd">
    
    <context:property-placeholder location="file://${idp.home}/conf/idp.properties" />

    <!-- Define custom flows, or override system flows, inside here. -->
    <webflow:flow-registry id="userFlowRegistry" base-path="file://${idp.home}/flows" flow-builder-services="flowBuilderServices">
    
        <!-- Directs event handling during the login process to custom flows like those below. -->
        <webflow:flow-location id="Authentication.Conditions" path="/authn/authn-conditions-flow.xml" />

        <!-- Login error/warning subflows that can be customized. -->
        <webflow:flow-location id="Authentication.ExpiringPassword" path="/authn/expiring-password-flow.xml" />
        <webflow:flow-location id="Authentication.ExpiredPassword" path="/authn/expired-password-flow.xml" />
        <webflow:flow-location id="Authentication.AccountLocked" path="/authn/account-locked-flow.xml" />
    </webflow:flow-registry>

    <!-- System-supplied flows, do not modify. -->
    <webflow:flow-registry id="flowRegistry" parent="userFlowRegistry" base-path="file://${idp.home}/system/flows" flow-builder-services="flowBuilderServices">

        <!-- Use dot-separated convention for abstract flows. -->
        <webflow:flow-location id="SAML1.SSO.Abstract" path="/saml1/sso-abstract-flow.xml" />
        <webflow:flow-location id="SAML2.SSO.Abstract" path="/saml2/sso-abstract-flow.xml" />
        
        <!-- Use slash-separated convention for web-executable flows. -->
        <webflow:flow-location id="Shibboleth/SSO" path="/saml1/sso-unsolicited-flow.xml"  />
        <webflow:flow-location id="SAML2/Redirect/SSO" path="/saml2/sso-redirect-flow.xml" />
        <webflow:flow-location id="SAML2/POST/SSO" path="/saml2/sso-post-flow.xml"  />
        <webflow:flow-location id="SAML2/Unsolicited/SSO" path="/saml2/sso-unsolicited-flow.xml"  />
    
        <webflow:flow-location id="Authentication.Abstract" path="/authn/authn-abstract-flow.xml" />
        <webflow:flow-location id="Authentication" path="/authn/authn-flow.xml" />
        
        <webflow:flow-location id="SubjectC14N.Abstract" path="/c14n/subject-c14n-abstract-flow.xml" />
        <webflow:flow-location id="SubjectC14N" path="/c14n/subject-c14n-flow.xml" />
        
        <!-- Login methods. -->
        <webflow:flow-location id="AuthenticationFlow/IPAddress" path="/authn/ipaddress-authn-flow.xml" />
        <webflow:flow-location id="AuthenticationFlow/RemoteUser" path="/authn/remoteuser-authn-flow.xml" />
        <webflow:flow-location id="AuthenticationFlow/JAAS" path="/authn/jaas-authn-flow.xml" />
        <webflow:flow-location id="AuthenticationFlow/LDAP" path="/authn/ldap-authn-flow.xml" />        
        
        <!-- C14N methods. -->
        <webflow:flow-location id="SubjectC14NFlow/Simple" path="/c14n/simple-subject-c14n-flow.xml" />
        <webflow:flow-location id="SubjectC14NFlow/SAML2/Transient" path="/c14n/saml2-transient-subject-c14n-flow.xml"  />
        <webflow:flow-location id="SubjectC14NFlow/SAML2/CryptoTransient" path="/c14n/saml2-crypto-transient-subject-c14n-flow.xml"  />
        <webflow:flow-location id="SubjectC14NFlow/LegacyPrincipalConnector" path="/c14n/legacy-pc-subject-c14n-flow.xml"  />
                
    </webflow:flow-registry>
    
    <webflow:flow-executor id="flowExecutor">
        <webflow:flow-execution-repository max-execution-snapshots="0"/>
    </webflow:flow-executor>
    
    <webflow:flow-builder-services id="flowBuilderServices" view-factory-creator="mvcViewFactoryCreator" />
    
    <bean id="mvcViewFactoryCreator" class="org.springframework.webflow.mvc.builder.MvcViewFactoryCreator">
        <property name="viewResolvers">
            <list>
                <ref bean="shibboleth.VelocityViewResolver" />
                <ref bean="shibboleth.InternalViewResolver" />
            </list>
        </property>
    </bean>
        
</beans>
